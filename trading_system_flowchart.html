<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading System 24x7 - Flow Chart</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 100%;
            margin: 0 auto;
            background-color: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            text-align: center;
            color: #2c3e50;
            margin-bottom: 30px;
        }
        .description {
            background-color: #ecf0f1;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        .legend {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 5px;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .legend-color {
            width: 20px;
            height: 20px;
            border-radius: 3px;
        }
        #mermaid-diagram {
            text-align: center;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ðŸš€ Advanced Options Trading System - Flow Chart</h1>
        
        <div class="description">
            <h3>ðŸ“Š System Overview</h3>
            <p><strong>Strategy:</strong> SHORT OPTIONS Trading with ML-Enhanced Decision Making</p>
            <p><strong>Operation:</strong> 24/7 Learning System (Live Trading + Offline Simulation)</p>
            <p><strong>Signals:</strong> 
                <span style="color: green;">ðŸŸ¢ SHORT PUT (Signal=1)</span> | 
                <span style="color: red;">ðŸ”´ SHORT CALL (Signal=-1)</span> | 
                <span style="color: gray;">âšª NEUTRAL (Signal=0)</span>
            </p>
            <p><strong>Integration:</strong> Direct API connection to Tradetron for signal execution</p>
        </div>

        <div id="mermaid-diagram">
            <div class="mermaid">
flowchart TD
    A[ðŸš€ System Start] --> B[Initialize Components]
    B --> C[Load Existing Models]
    C --> D[Initialize with Stored Data]
    D --> E[Main Analysis Loop]
    
    E --> F{Market Hours?}
    
    F -->|Yes - Live Mode| G[ðŸŸ¢ LIVE TRADING MODE]
    F -->|No - Offline Mode| H[ðŸŒ™ OFFLINE SIMULATION MODE]
    
    G --> I[Fetch Live Option Data]
    I --> J{Data Fetch Success?}
    J -->|No| K[Use Fallback Data]
    J -->|Yes| L[Store Live Data]
    
    H --> M[Load Stored Data]
    M --> N[Create Trading Simulation]
    N --> O[Use Sequential Data]
    
    K --> P[Get Nearest Strikes]
    L --> P
    O --> P
    
    P --> Q[Extract ML Features]
    Q --> R[Market Regime Detection]
    R --> S[ML Analysis & Predictions]
    
    S --> T{ML Model Trained?}
    T -->|No| U[Use Traditional Analysis]
    T -->|Yes| V[Advanced ML Predictions]
    
    U --> W[Feature-based Signals]
    V --> X[Ensemble ML Signals]
    
    W --> Y[Signal Generation]
    X --> Y
    
    Y --> Z{Paper Trade Active?}
    
    Z -->|Yes| AA[Check Exit Conditions]
    Z -->|No| BB[Check Entry Conditions]
    
    AA --> CC{Exit Signal?}
    CC -->|Yes| DD[ðŸš¨ Exit Trade]
    CC -->|No| EE[Continue Monitoring]
    
    BB --> FF{Signal Strength > Threshold?}
    FF -->|Yes| GG[Enter Paper Trade]
    FF -->|No| HH[No Action]
    
    DD --> II[ðŸ“¡ Send EXIT Signal to Tradetron]
    GG --> JJ[ðŸ“¡ Send ENTRY Signal to Tradetron]
    
    II --> KK[Update ML with Trade Outcome]
    JJ --> LL[Start Position Monitoring]
    
    KK --> MM[Calculate Performance Metrics]
    LL --> EE
    HH --> EE
    
    MM --> NN[Continuous Learning Update]
    EE --> NN
    
    NN --> OO{Retrain Models?}
    OO -->|Yes| PP[ðŸ”„ Model Training]
    OO -->|No| QQ[Collect Market Data]
    
    PP --> RR[SHAP Feature Analysis]
    RR --> SS[Save Updated Models]
    SS --> QQ
    
    QQ --> TT[Risk Management Check]
    TT --> UU[Performance Display]
    UU --> VV[System Cleanup]
    VV --> WW[Sleep & Wait]
    
    WW --> E
    
    subgraph "ðŸ§  ML Components"
        XX[Random Forest Classifier]
        YY[Gradient Boosting Models]
        ZZ[LSTM Deep Learning]
        AAA[SHAP Explainer]
        XX --> YY --> ZZ --> AAA
    end
    
    subgraph "ðŸ’° Risk Management"
        BBB[Position Sizing]
        CCC[Stop Loss Calculation]
        DDD[Trailing Stop Logic]
        EEE[Portfolio Risk Check]
        BBB --> CCC --> DDD --> EEE
    end
    
    subgraph "ðŸ“Š Data Management"
        FFF[Live Data Storage]
        GGG[Historical Data Access]
        HHH[Feature Extraction]
        III[Data Cleanup]
        FFF --> GGG --> HHH --> III
    end
    
    subgraph "ðŸŽ¯ Signal Types"
        JJJ[ðŸŸ¢ SHORT PUT<br/>Signal = 1]
        KKK[ðŸ”´ SHORT CALL<br/>Signal = -1]
        LLL[âšª NEUTRAL<br/>Signal = 0]
    end
    
    S -.-> XX
    Y -.-> JJJ
    Y -.-> KKK
    Y -.-> LLL
    
    L -.-> FFF
    Q -.-> HHH
    GG -.-> BBB
    AA -.-> CCC
    
    style A fill:#ff9999
    style G fill:#90EE90
    style H fill:#87CEEB
    style DD fill:#FFB6C1
    style GG fill:#98FB98
    style II fill:#FFA500
    style JJ fill:#FFA500
    style PP fill:#DDA0DD
    style JJJ fill:#90EE90
    style KKK fill:#FFB6C1
    style LLL fill:#F0F0F0
            </div>
        </div>

        <div class="legend">
            <h3>ðŸŽ¨ Color Legend:</h3>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #ff9999;"></div>
                <span>System Start</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #90EE90;"></div>
                <span>Live Mode / Entry Actions</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #87CEEB;"></div>
                <span>Offline Simulation</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFB6C1;"></div>
                <span>Exit Actions / Short Call</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #FFA500;"></div>
                <span>Signal Transmission</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background-color: #DDA0DD;"></div>
                <span>ML Training</span>
            </div>
        </div>

        <div class="description">
            <h3>ðŸ”„ Key Flow Points:</h3>
            <ul>
                <li><strong>Market Hours Detection:</strong> Automatically switches between live trading and offline simulation</li>
                <li><strong>ML Decision Engine:</strong> Uses ensemble of Random Forest, Gradient Boosting, and LSTM models</li>
                <li><strong>Signal Generation:</strong> SHORT PUT (bullish) vs SHORT CALL (bearish) based on market analysis</li>
                <li><strong>Risk Management:</strong> Dynamic position sizing, stop losses, and portfolio risk limits</li>
                <li><strong>Continuous Learning:</strong> Updates models based on trade outcomes and market data</li>
                <li><strong>24/7 Operation:</strong> Never stops learning - processes historical data during off-hours</li>
            </ul>
        </div>

        <div class="description">
            <h3>ðŸ’¡ Technical Features:</h3>
            <ul>
                <li><strong>SHAP Analysis:</strong> Explainable AI for feature importance</li>
                <li><strong>Market Regime Detection:</strong> Adapts strategy to market conditions</li>
                <li><strong>Paper Trading:</strong> Real-time position tracking and P&L calculation</li>
                <li><strong>Data Storage:</strong> Comprehensive market data collection and storage</li>
                <li><strong>Error Recovery:</strong> Circuit breakers and fallback mechanisms</li>
                <li><strong>Performance Monitoring:</strong> Real-time metrics and health checks</li>
            </ul>
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true
            }
        });
    </script>
</body>
</html> 